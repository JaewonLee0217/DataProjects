import java.awt.List;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Types;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

public class db_use {
	PreparedStatement pstmt1 = null;
	String url = "jdbc:mariadb://127.0.0.1:3306/testdb";
	public static Object getResultValue(int columnType, String columnName, ResultSet rs) throws SQLException {
		  if (columnType == Types.NUMERIC || columnType == Types.INTEGER || columnType == Types.BIGINT) {
		    return rs.getInt(columnName);

		  } else if (columnType == Types.DOUBLE || columnType == Types.FLOAT) {
		    return rs.getDouble(columnName);

		  } else if (columnType == Types.CHAR || columnType == Types.VARCHAR || columnType == Types.NVARCHAR) {
		    return rs.getString(columnName);

		  } else {
		    // 그 외의 경우는 전부 String 처리
		    return rs.getString(columnName);
		  }
		}
	// 계산한다.
	public void db_func(String sql, int choose) throws SQLException {
		Connection con = DriverManager.getConnection(url, "root", "2000");
		pstmt1  = con.prepareStatement(sql);
		ResultSet rs = pstmt1.executeQuery();
		ResultSetMetaData rsmd1 = rs.getMetaData();

		int numberOfColumns=rsmd1.getColumnCount();
		
		  ArrayList<Map> columnList = new ArrayList<>();

		  for (int i = 1; i <= numberOfColumns; i++) {
		    Map<String, Object> map = new HashMap<>();
		    map.put("name", rsmd1.getColumnName(i));
		    map.put("type", rsmd1.getColumnType(i));
		    columnList.add(map);
		  }
		  int k=1;
		  if (choose!=1) {
		  while (rs.next()) {
			  System.out.println("<"+k+">");
			    for (int i = 0; i < numberOfColumns; i++) {
			      Map columnInfo = columnList.get(i);
			      String columnName = (String) columnInfo.get("name");
			      int columnType = (int) columnInfo.get("type");

			      Object obj = getResultValue(columnType, columnName, rs);
			      System.out.println(i+1+". "+ columnName+": "+ obj);
			    }
			    k+=1;
			    System.out.println("\n");

		  }
		  }
		  else if (choose==1) {
			  while (rs.next()) {
				    for (int i = 0; i < numberOfColumns; i++) {
				      Map columnInfo = columnList.get(i);
				      String columnName = (String) columnInfo.get("name");
				      int columnType = (int) columnInfo.get("type");

				      Object obj = getResultValue(columnType, columnName, rs);
				      System.out.println(obj);
				    }
			  }
		  }
		  con.close();
		  rs.close();
		  
	}
}
	
